# 第2章 MonogDB基本原理及安装
---

## 2.1 数据库结构
* 一个 MongoDB 实例可以承载多个数据库, 它们之间是完全独立的. 每个数据库也有独立的权限控制, 在磁盘上不同的数据库放置在不同的文件中. 一个应用的所有数据建议存储在同一个数据库中. 当同一个 MongoDB 服务器上存放多个应用或者用户数据时, 可以使用多个数据库, 每个应用对应一个数据库.
* 数据库名最终会变成系统中的文件. 数据库名应全部小写. 数据库名最多 64k.
* MongoDB 有一些特殊作用的数据库:
| 特殊数据库 | 作用 	|
|--------|--------	|
| Admin	 |从权限角度看,相当于"root"数据库.在admin数据库中添加的用户会自动继承所有数据库的权限.一下特定的服务器端命令也只能从这个数据库运行, 如列数所有的数据库,关闭服务器等|
|Local   | 该数据库永远不会被复制, 可以用来存储限于本地单台服务器的任意集合|
|Config|当 MongoDB 数据库用于分片设置时, config数据库再内部使用, 用于保存分片的相关信息|
* MongoDB 服务启动后, 由实例和数据库组成, 一般情况下, 一个 MongoDB 服务包含一个实例和多个与之对应的数据库.
* MongoDB 数据库由一系列的物理文件 ( 如数据文件, 日志文件等 ) 的集合或与之对应的逻辑结构 ( 如集合, 文档 ) 组成.
* MongoDB 的 **逻辑结构** 主要由 文档 ( Document ), 集合 ( Collection ), 数据库 ( Database ) 3 部分组成. MongoDB 的文档相当于关系型数据库中的一行记录. 多个文档组成一个集合相当于关系型数据库的表. 多个集合逻辑上组织在一起, 就是数据库. 一个 MongoDB 实例支持多个数据库.
* **存储结构** : MongoDB 的默认数据目录是 /data/db, MongoDB 所有的数据文件都放在此目录下. 每个数据库都包含一个 .ns 文件和一些数据库文件. 如系统中有 personal 数据库, 那么在数据目录下面就会有 personal.ns, pesonal.0, personal.1 等文件.
* MongoDB 数据库中每个集合和每个索引都有对应的命名空间, 这些命名空间的元数据都集中在 *.ns 文件中, 命名空间是把数据库的名称放在集合的前面, 例如, personal 这个集合中有一个 personalinfo 集合, 那么这个集合的命名空间为 personal.personalinfo, 命名空间的最大长度为 121 字节, 实际应用中应小于 100 字节.

## 2.2 文档
* 文档中的键类似于关系型数据库中的字段.
* 键值 **区分类型** 和大小写. 如下面两个文档是不同的.
> {"age" : 8}
> {"age" : "8"}

	一个值为整型, 而另一个为字符串型
* 文档是 MongoDB 中数据的基本单元, 多个键值对有序地放置在一起便是文档.
* 文档中的键值对是有序的, 如下面的例子,所代表的文档也是不一样的.
> { "name" : "zhangsan", "age" : 8 }
> { "age" : 8, "name" : "zhangsan" }

## 2.3 集合
* 子集合非常有用, 如 GridFS 是一种存储大文件的协议, 使用子集合来存储文件的元数据, 这样就与内容块分开了.

## 2.4 MongoDB 数据类型
### 2.4.1 基本数据类型
* JSON 仅包含 6 种数据类型: null, 布尔, 数字, 字符串, 数组, 对象
* MongoDB 在保留 JSON 基本的键值对特性的基础上, 添加了其他一些数据类型. 添加了很多种哦.

### 2.4.2 数字类型
* MongoDB 中有 3 种数字类型: 32 位整数, 64 位整数, 64 位双精度浮点数.
* Shell 中的数字都被当做双精度, 所以尽量不要在 Shell 下覆盖整个文档.

### 2.4.3 日期类型
* 在 JavaScript 中, Data 对象用做 MongoDB 的日期类型. 创建一个新的 Data 对象时, 通常会调用 new Data(...). **注意**, 调用 Data(...) 实际返回的是对日期的字符串表示, 而不是真正的 Data 对象. 不要两者混用.

### 2.4.4 数组类型
* 数组由一组值组成. 数组中可以包含不同数据类型的元素. 如下 "testArray" 键的值就是一个数组:
> { "testArray" : [ "a", "b", "c", 12.31 ] }

### 2.4.5 内嵌文档类型
* 把整个文档作为另一个文档中键的值称为内嵌文档. 如下, 可以看出内嵌文档能更好的组织信息:
```
{
	"name" : "zhangsan",
    "age" : 8,
    "address" : {
    	"city" : "beijing",
        "street" : "816 Park Street"
    }
}
```
* 和数组一样, MongoDB 能够理解内嵌文档的结构, 并且可以深入其中构建索引, 执行查询或者更新.

### 2.4.6 _id 键和 Object 对象